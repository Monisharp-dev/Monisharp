<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoniSharp RPS</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
      background:radial-gradient(circle at top,#0f2027,#203a43,#2c5364);
      color:#fff;display:flex;flex-direction:column;
      align-items:center;padding:20px;min-height:100vh;overflow-x:hidden;
    }
    header{width:100%;display:flex;justify-content:space-between;margin-bottom:20px;}
    .balance-box{
      background:rgba(255,255,255,0.1);padding:12px 20px;border-radius:12px;
      backdrop-filter:blur(8px);font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    .game-container{
      background:rgba(255,255,255,0.08);padding:25px;border-radius:18px;text-align:center;
      max-width:480px;width:100%;box-shadow:0 8px 25px rgba(0,0,0,0.4);
    }
    h1{font-size:1.8rem;margin-bottom:10px;}

    .arena{display:flex;flex-direction:column;align-items:center;gap:40px;margin:20px 0;}
    .hand{
      width:100px;height:100px;font-size:3rem;
      display:flex;align-items:center;justify-content:center;
      border-radius:50%;background:rgba(255,255,255,0.1);
      box-shadow:0 6px 16px rgba(0,0,0,0.4);transform-origin:center;
    }
    .bot-hand{transform:rotate(180deg);}
    .shake{animation:shake 0.6s ease-in-out 3;}
    @keyframes shake{
      0%{transform:translateX(0);}
      25%{transform:translateX(-15px);}
      50%{transform:translateX(15px);}
      75%{transform:translateX(-15px);}
      100%{transform:translateX(0);}
    }

    .buttons{margin:20px 0;display:flex;justify-content:center;gap:12px;}
    button{
      padding:12px 18px;border:none;border-radius:8px;font-size:1rem;
      cursor:pointer;font-weight:600;color:#fff;transition:0.3s;
    }
    button:hover{transform:scale(1.05);}
    .rock{background:linear-gradient(135deg,#6c757d,#495057);}
    .paper{background:linear-gradient(135deg,#007bff,#0056b3);}
    .scissors{background:linear-gradient(135deg,#e83e8c,#c2185b);}

    .result{margin-top:15px;font-size:1.1rem;font-weight:600;}

    .popup{
      position:fixed;top:30px;left:50%;transform:translateX(-50%);
      background:linear-gradient(135deg,#FFD700,#FF8C00);
      color:#000;padding:14px 22px;border-radius:10px;
      box-shadow:0 8px 20px rgba(0,0,0,0.4);
      opacity:0;pointer-events:none;transition:all 0.4s ease;font-weight:600;
    }
    .popup.show{opacity:1;top:50px;pointer-events:auto;}

    /* Help Modal */
    .help-modal{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;
      opacity:0;pointer-events:none;transition:opacity 0.3s ease;
    }
    .help-modal.active{opacity:1;pointer-events:auto;}
    .help-content{
      background:#fff;color:#000;padding:25px;border-radius:15px;
      max-width:400px;width:90%;text-align:left;
      box-shadow:0 10px 25px rgba(0,0,0,0.4);animation:slideUp 0.4s ease;
    }
    @keyframes slideUp{from{transform:translateY(50px);opacity:0;}to{transform:translateY(0);opacity:1;}}
    .help-content h3{margin-bottom:12px;font-size:1.2rem;}
    .help-content ul{margin-left:18px;line-height:1.6;}
    .close-btn{margin-top:15px;padding:8px 14px;background:#203a43;color:#fff;border:none;border-radius:8px;cursor:pointer;}
  </style>
</head>
<body>
  <header>
    <div class="balance-box">Deposit: ‚Ç¶<span id="depositBalance">0</span></div>
    <div class="balance-box">Game: ‚Ç¶<span id="gameBalance">0</span></div>
  </header>

  <div class="game-container">
    <h1>‚úä‚úã‚úå Rock‚ÄìPaper‚ÄìScissors</h1>
    <div class="arena">
      <div class="hand bot-hand" id="botHand">‚ùî</div>
      <div class="hand player-hand" id="playerHand">‚ùî</div>
    </div>

    <p>Stake: ‚Ç¶20</p>
    <div class="buttons">
      <button class="rock" onclick="playRPS('Rock')">Rock</button>
      <button class="paper" onclick="playRPS('Paper')">Paper</button>
      <button class="scissors" onclick="playRPS('Scissors')">Scissors</button>
    </div>
    <div class="result" id="result"></div>
    <button style="margin-top:15px;background:#ff6b6b;" onclick="toggleHelp()">üìñ Help</button>
  </div>

  <!-- Help Modal -->
  <div class="help-modal" id="helpModal">
    <div class="help-content">
      <h3>üìñ How to Play</h3>
      <ul>
        <li>Each play costs <b>‚Ç¶20</b> from your deposit.</li>
        <li>Win = ‚Ç¶30 added to your Game Balance.</li>
        <li>Lose = no credit.</li>
        <li>Draw = Stake refunded.</li>
        <li>Rock beats Scissors, Scissors beats Paper, Paper beats Rock.</li>
      </ul>
      <button class="close-btn" onclick="toggleHelp()">Close</button>
    </div>
  </div>

  <div class="popup" id="popup"></div>

  <!-- Sounds -->
  <audio id="countSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" preload="auto"></audio>
  <audio id="loseSound" src="https://www.soundjay.com/button/sounds/button-10.mp3" preload="auto"></audio>
  <audio id="drawSound" src="https://www.soundjay.com/button/sounds/button-09.mp3" preload="auto"></audio>
  <audio id="bgMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop preload="auto"></audio>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const userId = localStorage.getItem("Id") || "defaultUser";
  const depositKey = `depositBalance_${userId}`;
  const gameKey = `gameBalance_${userId}`;
  const cycleKey = `rpsCycle_${userId}`;

  if (!localStorage.getItem(depositKey)) localStorage.setItem(depositKey, 0);
  if (!localStorage.getItem(gameKey)) localStorage.setItem(gameKey, 0);
  updateBalances();

  const stake = 20;
  const icons = { Rock: "‚úä", Paper: "‚úã", Scissors: "‚úå" };

  const countSound = document.getElementById("countSound");
  const winSound = document.getElementById("winSound");
  const loseSound = document.getElementById("loseSound");
  const drawSound = document.getElementById("drawSound");
  const bgMusic = document.getElementById("bgMusic");

  document.body.addEventListener("click", () => {
    if (bgMusic.paused) { bgMusic.volume = 0.2; bgMusic.play(); }
  }, { once: true });

  // --- Cycle Control ---
  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  let cycleState = JSON.parse(localStorage.getItem(cycleKey)) || {
    outcomes: [],
    index: 0
  };

  function saveCycle() {
    localStorage.setItem(cycleKey, JSON.stringify(cycleState));
  }

  function generateCycle() {
    // 2 wins, 3 losses, 1 draw
    const base = ["W", "W", "L", "L", "L", "D"];
    cycleState.outcomes = shuffleArray(base);
    cycleState.index = 0;
    saveCycle();
  }

  function nextOutcome() {
    if (!cycleState.outcomes.length || cycleState.index >= cycleState.outcomes.length) {
      generateCycle();
    }
    const outcome = cycleState.outcomes[cycleState.index];
    cycleState.index++;
    saveCycle();
    return outcome;
  }

  // --- Play Game ---
  window.playRPS = (playerChoice) => {
    let deposit = parseInt(localStorage.getItem(depositKey));
    let game = parseInt(localStorage.getItem(gameKey));
    if (deposit < stake) { showPopup("‚ùå Insufficient deposit balance!"); return; }
    deposit -= stake; localStorage.setItem(depositKey, deposit);

    const choices = ["Rock", "Paper", "Scissors"];
    let botChoice = choices[Math.floor(Math.random() * 3)];

    const playerHand = document.getElementById("playerHand");
    const botHand = document.getElementById("botHand");
    playerHand.textContent = "‚úä";
    botHand.textContent = "‚úä";
    playerHand.classList.add("shake");
    botHand.classList.add("shake");

    countSound.currentTime = 0; countSound.play();

    setTimeout(() => {
      playerHand.classList.remove("shake");
      botHand.classList.remove("shake");
      playerHand.textContent = icons[playerChoice];

      let outcome = nextOutcome();
      let resultText = "";

      if (outcome === "W") {
        // Bot move that loses
        const loseMap = { Rock: ["Scissors"], Paper: ["Rock"], Scissors: ["Paper"] };
        botChoice = loseMap[playerChoice][Math.floor(Math.random() * loseMap[playerChoice].length)];
        botHand.textContent = icons[botChoice];
        let winAmount = stake * 1.5;
        game += winAmount;
        localStorage.setItem(gameKey, game);
        resultText = `üéâ You WIN! ${playerChoice} beats ${botChoice}. +‚Ç¶${winAmount}`;
        showPopup("üéâ Victory!");
        winSound.play();
      } else if (outcome === "L") {
        // Bot move that wins
        const winMap = { Rock: ["Paper"], Paper: ["Scissors"], Scissors: ["Rock"] };
        botChoice = winMap[playerChoice][Math.floor(Math.random() * winMap[playerChoice].length)];
        botHand.textContent = icons[botChoice];
        resultText = `üò¢ You lost! ${botChoice} beats ${playerChoice}`;
        showPopup("üò¢ Defeat!");
        loseSound.play();
      } else {
        // Draw ‚Üí refund stake
        botChoice = playerChoice;
        botHand.textContent = icons[botChoice];
        deposit += stake; 
        localStorage.setItem(depositKey, deposit);
        resultText = `ü§ù Draw! Both chose ${playerChoice}. Stake refunded.`;
        showPopup("ü§ù Draw! Stake refunded.");
        drawSound.play();
      }

      document.getElementById("result").textContent = resultText;
      updateBalances();
    }, 1800);
  };

  function updateBalances() {
    document.getElementById("depositBalance").textContent = localStorage.getItem(depositKey);
    document.getElementById("gameBalance").textContent = localStorage.getItem(gameKey);
  }

  function showPopup(msg) {
    const popup = document.getElementById("popup");
    popup.textContent = msg;
    popup.classList.add("show");
    setTimeout(() => popup.classList.remove("show"), 2500);
  }

  window.toggleHelp = () => {
    document.getElementById("helpModal").classList.toggle("active");
  };
});
</script>
</body>
</html>