<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Target Shooter</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #141E30, #243B55);
      color: #fff;
      overflow-x: hidden;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0,0,0,0.4);
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    header h1 {
      font-size: 1.2em;
      margin: 0;
      color: #ffcc00;
    }

    .balances {
      display: flex;
      gap: 15px;
    }
    .balance-box {
      background: rgba(255,255,255,0.1);
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .balance-box i { color: gold; }

    .loader {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70vh;
      font-size: 1.2em;
    }

    .game-container {
      display: none;
      text-align: center;
      padding: 20px;
      animation: fadeIn 1s ease;
    }

    .scoreboard {
      display: flex;
      justify-content: space-around;
      background: rgba(255,255,255,0.05);
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .score { font-weight: bold; }

    .timer { font-size: 1.1em; margin: 10px 0; }

    .play-area {
      position: relative;
      width: 100%;
      max-width: 360px;
      height: 400px;
      margin: 0 auto;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      overflow: hidden;
    }

    .target {
      position: absolute;
      width: 40px;
      height: 40px;
      background: red;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(255,0,0,0.7);
      animation: fadeIn 0.3s ease;
    }

    .notification {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(0,0,0,0.6);
      animation: popIn 0.5s ease;
      z-index: 1000;
    }
    .notification h2 {
      margin: 0 0 10px;
      color: #ffcc00;
    }

    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    @keyframes popIn { from {transform:translate(-50%,-20%) scale(0.8); opacity:0;} to {transform:translate(-50%,0) scale(1); opacity:1;} }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<header>
  <h1>üéØ Target Shooter</h1>
  <div class="balances">
    <div class="balance-box"><i class="fas fa-wallet"></i> Deposit: ‚Ç¶<span id="depositBalance">0</span></div>
    <div class="balance-box"><i class="fas fa-coins"></i> Game: ‚Ç¶<span id="gameBalance">0</span></div>
  </div>
</header>

<div class="loader" id="loader">‚è≥ Searching for opponent...</div>

<div class="game-container" id="gameContainer">
  <div class="scoreboard">
    <div class="score">You: <span id="userScore">0</span></div>
    <div class="score">VS</div>
    <div class="score"><span id="botName"></span>: <span id="botScore">0</span></div>
  </div>
  <div class="timer">‚è∞ Time Left: <span id="timeLeft">30</span>s</div>
  <div class="play-area" id="playArea"></div>
</div>

<div class="notification" id="resultBox">
  <h2 id="resultTitle">Result</h2>
  <p id="resultText"></p>
  <button onclick="startGame()">Play Again</button>
</div>

<!-- Sounds -->
<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3dd9d8b2a3.mp3?filename=arcade-music-loop-110997.mp3" type="audio/mpeg">
</audio>
<audio id="shootSound"><source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg"></audio>
<audio id="winSound"><source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg"></audio>
<audio id="loseSound"><source src="https://actions.google.com/sounds/v1/cartoon/concussive_drum_hit.ogg" type="audio/ogg"></audio>

<script>
const userId = localStorage.getItem("Id") || "guest";
const depositKey = "depositBalance_" + userId;
const gameKey = "gameBalance_" + userId;
const cycleKey = "targetShooterCycle_" + userId;

let depositBalance = parseInt(localStorage.getItem(depositKey)) || 0;
let gameBalance = parseInt(localStorage.getItem(gameKey)) || 0;
let firstPlay = localStorage.getItem("targetShooterFirstPlay") || "true";

const depositEl = document.getElementById("depositBalance");
const gameEl = document.getElementById("gameBalance");
const userScoreEl = document.getElementById("userScore");
const botScoreEl = document.getElementById("botScore");
const timeEl = document.getElementById("timeLeft");
const playArea = document.getElementById("playArea");
const loader = document.getElementById("loader");
const gameContainer = document.getElementById("gameContainer");
const resultBox = document.getElementById("resultBox");
const resultTitle = document.getElementById("resultTitle");
const resultText = document.getElementById("resultText");
const botNameEl = document.getElementById("botName");

const bgMusic = document.getElementById("bgMusic");
const shootSound = document.getElementById("shootSound");
const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");

// üîä Sound toggle button
const soundToggle = document.createElement("button");
soundToggle.textContent = "üîä Sound";
soundToggle.style.position = "fixed";
soundToggle.style.bottom = "15px";
soundToggle.style.right = "15px";
soundToggle.style.padding = "8px 14px";
soundToggle.style.borderRadius = "8px";
soundToggle.style.border = "none";
soundToggle.style.background = "#222";
soundToggle.style.color = "#fff";
soundToggle.style.cursor = "pointer";
document.body.appendChild(soundToggle);

soundToggle.onclick = () => {
  bgMusic.muted = !bgMusic.muted;
  soundToggle.textContent = bgMusic.muted ? "üîá Muted" : "üîä Sound";
};

let userScore = 0, botScore = 0, timeLeft = 30;
let timer;
let hideBotScore = false;   // hide bot score during round

// =============== CYCLE SYSTEM ===================
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function loadCycle() {
  let cycle = JSON.parse(localStorage.getItem(cycleKey));
  if (!cycle || cycle.steps.length === 0) {
    // Generate new cycle
    const userWins = 1 + Math.floor(Math.random() * 2);  // 1‚Äì2
    const botWins = 3 + Math.floor(Math.random() * 5);   // 3‚Äì7
    let steps = [];
    for (let i = 0; i < userWins; i++) steps.push("user");
    for (let i = 0; i < botWins; i++) steps.push("bot");
    steps = shuffleArray(steps); // random order
    cycle = { steps, index: 0 };
    localStorage.setItem(cycleKey, JSON.stringify(cycle));
  }
  return cycle;
}

function saveCycle(cycle) {
  localStorage.setItem(cycleKey, JSON.stringify(cycle));
}
// =================================================

function updateBalances() {
  depositEl.textContent = depositBalance;
  gameEl.textContent = gameBalance;
  localStorage.setItem(depositKey, depositBalance);
  localStorage.setItem(gameKey, gameBalance);
}
updateBalances();

async function getBotName() {
  try {
    const res = await fetch("https://randomuser.me/api/?nat=NG");
    const data = await res.json();
    return data.results[0].name.first + " " + data.results[0].name.last;
  } catch {
    const fallback = [
      "Chinedu Okafor","Ngozi Balogun","Aisha Musa","Emeka Obi","Temitope Adeyemi",
      "Ifeanyi Nwankwo","Bola Akinyemi","Fatima Abdullahi","Obinna Eze","Yetunde Oladipo",
      "Yakubu Ibrahim","Chiamaka Okeke","Kunle Ogunleye","Hauwa Bello","Nnamdi Anyaorah",
      "Oluwaseun Ajayi","Blessing Udo","Musa Danjuma","Amarachi Nwachukwu","Gbenga Alabi",
      "Maryam Sani","Ikenna Onoh","Adesuwa Okojie","Samuel Olatunji","Khadija Yusuf",
      "Tochukwu Umeh","Folake Lawal","Ibrahim Garba","Uchechi Duru","Segun Falade",
      "Chioma Nnaji","Usman Shehu","Kelechi Okorie","Opeyemi Bamidele","Hadiza Mohammed",
      "Olumide Fashola","Zainab Suleiman","Ebuka Onuoha","Ruqayyah Ahmed","Tunde Bakare",
      "Patience Ekanem","Chukwudi Okoro","Halima Idris","Sunday Awolowo","Ijeoma Anyanwu",
      "Danjuma Hassan"
    ];
    return fallback[Math.floor(Math.random() * fallback.length)];
  }
}

function showLoader() {
  loader.style.display = "flex";
  gameContainer.style.display = "none";
  resultBox.style.display = "none";
  setTimeout(() => {
    loader.style.display = "none";
    startRound();
  }, 3000 + Math.random() * 2000);
}

function startGame() {
  if (firstPlay === "true") {
    localStorage.setItem("targetShooterFirstPlay", "false");
  } else {
    if (depositBalance < 20) {
      alert("Not enough deposit to play!");
      return;
    }
    depositBalance -= 20;
    updateBalances();
  }

  bgMusic.volume = 0.5;
  bgMusic.loop = true;
  bgMusic.play().catch(() => console.warn("Music blocked until user interacts."));

  showLoader();
}

async function startRound() {
  botNameEl.textContent = await getBotName();
  gameContainer.style.display = "block";
  userScore = 0; botScore = 0; timeLeft = 30;
  userScoreEl.textContent = userScore;
  botScoreEl.textContent = "..."; // hide bot score
  hideBotScore = true;
  timeEl.textContent = timeLeft;

  timer = setInterval(() => {
    timeLeft--;
    timeEl.textContent = timeLeft;
    if (timeLeft <= 0) endRound();
  }, 1000);

  spawnTarget();
}

function spawnTarget() {
  if (timeLeft <= 0) return;
  const target = document.createElement("div");
  target.className = "target";
  target.style.top = Math.random() * 360 + "px";
  target.style.left = Math.random() * 320 + "px";
  playArea.appendChild(target);

  target.onclick = () => {
    shootSound.play();
    userScore++;
    userScoreEl.textContent = userScore;
    target.remove();
  };

  setTimeout(() => target.remove(), 1200);
  setTimeout(spawnTarget, 800);
}

function endRound() {
  clearInterval(timer);
  playArea.innerHTML = "";

  // üîÑ Load current cycle
  let cycle = loadCycle();
  let currentStep = cycle.steps[cycle.index];

  let userWins = false;

  if (currentStep === "user") {
    userWins = true;
    botScore = Math.max(0, userScore - (1 + Math.floor(Math.random() * 3))); // bot slightly lower
  } else {
    userWins = false;
    botScore = userScore + (2 + Math.floor(Math.random() * 7)); // bot stronger
  }

  cycle.index++;
  if (cycle.index >= cycle.steps.length) {
    // Reset cycle
    localStorage.removeItem(cycleKey);
  } else {
    saveCycle(cycle);
  }

  hideBotScore = false;
  botScoreEl.textContent = botScore;

  if (userWins) {
    gameBalance += 30;
    updateBalances();
    winSound.play();
    resultTitle.textContent = "üèÜ You Win!";
    resultText.textContent = `You: ${userScore}, Opponent: ${botScore}. +‚Ç¶35 Game Balance`;
  } else {
    loseSound.play();
    resultTitle.textContent = "üòû You Lost!";
    resultText.textContent = `You: ${userScore}, Opponent: ${botScore}. Better luck next time.`;
  }

  resultBox.style.display = "block";
}

// üöÄ Autostart
window.addEventListener("load", startGame);
</script>
<script src="depo-cop.js"></script>

</body>
</html>